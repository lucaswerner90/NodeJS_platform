<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: email/email_sender.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: email/email_sender.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>const CONFIG=require('./config.json');
const nodemailer=require('nodemailer');
const fs=require('fs');

/**
 * 
 * 
 * @class EmailSender
 */
class EmailSender{
  constructor(){
    this._smtpTransport = nodemailer.createTransport(CONFIG.BASIC_CONF.server_IP);
    this.mail_options=CONFIG.MAIL_INFO;
  }

  
  /**
   * 
   * 
   * @param {string} [id="new_course"] 
   * @returns {string} 
   * 
   * @memberof EmailSender
   */
  _config_template(id="new_course"){
    for (let i = 0; i &lt; CONFIG.TEMPLATES_CONF.length; i++) {
      let template=CONFIG.TEMPLATES_CONF[i];
      if(template.id===id) return template;
    }
    return;
  }


  /**
   * 
   * 
   * @param {string} [html=""] 
   * @param {object} info_content 
   * @returns {string} Final email html template
   * 
   * @memberof EmailSender
   */
  replace_variables(html="",info_content){
    const email_info=["titulo_curso","num_certificados","num_contenidos","horas_formacion","ruta_ejecucion"];
    for (let i = 0; i &lt; email_info.length; i++) {
      html=html.split("{"+email_info[i]+"}").join(info_content[email_info[i]]);
    }
    return html;
  }



  /**
   * 
   * 
   * @param {string} [type="new_course"] 
   * @param {object} [info={}] 
   * @returns {Promise}
   * 
   * @memberof EmailSender
   */
  send_email(type="new_course",info={}){
    const _self=this;
    const template=_self._config_template(type);
    _self.mail_options.subject=template.subject+" - "+info.titulo;
    let index_content="";
    return new Promise(function(resolve, reject) {

      _self.mail_options.html=fs.createReadStream(__dirname+template.folder_template+'/mail.html');

      _self.mail_options.html.on('data', (chunk) => {
        index_content+=chunk.toString();
      });
      _self.mail_options.html.on('end', () => {
        _self.mail_options.html=_self.replace_variables(index_content,{
          titulo_curso:info.titulo,
          num_certificados:"56",
          num_contenidos:"110",
          horas_formacion:"255",
          ruta_ejecucion:info.rutaEjecucion
        });

        _self.mail_options.to=_self.mail_options.to.join();
        _self._smtpTransport.sendMail(_self.mail_options, function(error, response){
          if(error){
            reject(error);
          }else{
            resolve("Email sended...."+response.message);
          }
        });




      });


    });
  }



}

module.exports=EmailSender;
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-authentication_config.html">authentication/config</a></li><li><a href="module-authentication_coreFunctions.html">authentication/coreFunctions</a></li><li><a href="module-authentication_index.html">authentication/index</a></li><li><a href="module-authentication_middleware.html">authentication/middleware</a></li></ul><h3>Classes</h3><ul><li><a href="ClientMicroservice.html">ClientMicroservice</a></li><li><a href="Database.html">Database</a></li><li><a href="DatabaseMicroservice.html">DatabaseMicroservice</a></li><li><a href="EmailMicroservice.html">EmailMicroservice</a></li><li><a href="EmailSender.html">EmailSender</a></li><li><a href="File.html">File</a></li><li><a href="Form.Form.html">Form</a></li><li><a href="FTPModel.html">FTPModel</a></li><li><a href="Microservices.html">Microservices</a></li><li><a href="ServerStart.html">ServerStart</a></li><li><a href="User.html">User</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.3</a> on Mon May 29 2017 12:01:47 GMT+0200 (CEST)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
