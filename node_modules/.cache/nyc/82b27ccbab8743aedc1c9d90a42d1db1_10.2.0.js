var cov_1l1ii2sp80=function(){var path='/Users/je10617/Desktop/express-authenticate/files/_fileModel.js',hash='e8a845b73528177d12d28911620b60459ac0df4d',global=new Function('return this')(),gcv='__coverage__',coverageData={path:'/Users/je10617/Desktop/express-authenticate/files/_fileModel.js',statementMap:{'0':{start:{line:1,column:11},end:{line:1,column:26}},'1':{start:{line:2,column:9},end:{line:2,column:22}},'2':{start:{line:3,column:24},end:{line:3,column:48}},'3':{start:{line:4,column:10},end:{line:4,column:32}},'4':{start:{line:5,column:13},end:{line:5,column:37}},'5':{start:{line:12,column:4},end:{line:12,column:24}},'6':{start:{line:13,column:4},end:{line:13,column:24}},'7':{start:{line:17,column:16},end:{line:17,column:20}},'8':{start:{line:18,column:4},end:{line:18,column:35}},'9':{start:{line:22,column:4},end:{line:22,column:67}},'10':{start:{line:27,column:16},end:{line:27,column:26}},'11':{start:{line:28,column:16},end:{line:28,column:83}},'12':{start:{line:29,column:14},end:{line:29,column:78}},'13':{start:{line:30,column:16},end:{line:30,column:83}},'14':{start:{line:31,column:18},end:{line:31,column:89}},'15':{start:{line:32,column:18},end:{line:32,column:89}},'16':{start:{line:33,column:4},end:{line:33,column:83}},'17':{start:{line:38,column:4},end:{line:42,column:5}},'18':{start:{line:39,column:6},end:{line:41,column:7}},'19':{start:{line:40,column:8},end:{line:40,column:20}},'20':{start:{line:43,column:4},end:{line:43,column:17}},'21':{start:{line:48,column:4},end:{line:53,column:5}},'22':{start:{line:50,column:8},end:{line:50,column:83}},'23':{start:{line:52,column:8},end:{line:52,column:116}},'24':{start:{line:60,column:16},end:{line:60,column:20}},'25':{start:{line:63,column:18},end:{line:63,column:20}},'26':{start:{line:67,column:6},end:{line:67,column:23}},'27':{start:{line:68,column:6},end:{line:68,column:21}},'28':{start:{line:69,column:6},end:{line:69,column:26}},'29':{start:{line:72,column:4},end:{line:107,column:7}},'30':{start:{line:73,column:6},end:{line:106,column:7}},'31':{start:{line:75,column:8},end:{line:75,column:54}},'32':{start:{line:79,column:8},end:{line:89,column:9}},'33':{start:{line:81,column:10},end:{line:81,column:61}},'34':{start:{line:82,column:10},end:{line:82,column:96}},'35':{start:{line:83,column:10},end:{line:83,column:43}},'36':{start:{line:87,column:10},end:{line:87,column:100}},'37':{start:{line:88,column:10},end:{line:88,column:44}},'38':{start:{line:92,column:8},end:{line:92,column:56}},'39':{start:{line:93,column:8},end:{line:102,column:11}},'40':{start:{line:94,column:10},end:{line:96,column:11}},'41':{start:{line:95,column:12},end:{line:95,column:137}},'42':{start:{line:97,column:10},end:{line:97,column:24}},'43':{start:{line:100,column:10},end:{line:100,column:28}},'44':{start:{line:101,column:10},end:{line:101,column:22}},'45':{start:{line:104,column:8},end:{line:104,column:26}},'46':{start:{line:105,column:8},end:{line:105,column:52}},'47':{start:{line:111,column:16},end:{line:111,column:20}},'48':{start:{line:112,column:4},end:{line:130,column:7}},'49':{start:{line:113,column:6},end:{line:129,column:9}},'50':{start:{line:114,column:24},end:{line:114,column:81}},'51':{start:{line:116,column:10},end:{line:124,column:13}},'52':{start:{line:117,column:12},end:{line:117,column:27}},'53':{start:{line:120,column:12},end:{line:120,column:24}},'54':{start:{line:123,column:12},end:{line:123,column:31}},'55':{start:{line:128,column:8},end:{line:128,column:20}},'56':{start:{line:136,column:16},end:{line:136,column:20}},'57':{start:{line:137,column:4},end:{line:148,column:7}},'58':{start:{line:139,column:8},end:{line:139,column:38}},'59':{start:{line:141,column:8},end:{line:144,column:11}},'60':{start:{line:142,column:10},end:{line:142,column:38}},'61':{start:{line:147,column:6},end:{line:147,column:25}},'62':{start:{line:158,column:0},end:{line:158,column:20}}},fnMap:{'0':{name:'(anonymous_0)',decl:{start:{line:11,column:2},end:{line:11,column:3}},loc:{start:{line:11,column:15},end:{line:14,column:3}},line:11},'1':{name:'(anonymous_1)',decl:{start:{line:16,column:2},end:{line:16,column:3}},loc:{start:{line:16,column:21},end:{line:19,column:3}},line:16},'2':{name:'(anonymous_2)',decl:{start:{line:21,column:2},end:{line:21,column:3}},loc:{start:{line:21,column:21},end:{line:23,column:3}},line:21},'3':{name:'(anonymous_3)',decl:{start:{line:26,column:2},end:{line:26,column:3}},loc:{start:{line:26,column:25},end:{line:34,column:3}},line:26},'4':{name:'(anonymous_4)',decl:{start:{line:37,column:2},end:{line:37,column:3}},loc:{start:{line:37,column:47},end:{line:44,column:3}},line:37},'5':{name:'(anonymous_5)',decl:{start:{line:47,column:2},end:{line:47,column:3}},loc:{start:{line:47,column:61},end:{line:54,column:3}},line:47},'6':{name:'(anonymous_6)',decl:{start:{line:58,column:2},end:{line:58,column:3}},loc:{start:{line:58,column:83},end:{line:108,column:3}},line:58},'7':{name:'removeVariables',decl:{start:{line:66,column:13},end:{line:66,column:28}},loc:{start:{line:66,column:30},end:{line:70,column:5}},line:66},'8':{name:'(anonymous_8)',decl:{start:{line:72,column:23},end:{line:72,column:24}},loc:{start:{line:72,column:41},end:{line:107,column:5}},line:72},'9':{name:'(anonymous_9)',decl:{start:{line:93,column:61},end:{line:93,column:62}},loc:{start:{line:93,column:65},end:{line:98,column:9}},line:93},'10':{name:'(anonymous_10)',decl:{start:{line:99,column:15},end:{line:99,column:16}},loc:{start:{line:99,column:22},end:{line:102,column:9}},line:99},'11':{name:'(anonymous_11)',decl:{start:{line:110,column:2},end:{line:110,column:3}},loc:{start:{line:110,column:33},end:{line:132,column:3}},line:110},'12':{name:'(anonymous_12)',decl:{start:{line:112,column:23},end:{line:112,column:24}},loc:{start:{line:112,column:41},end:{line:130,column:5}},line:112},'13':{name:'(anonymous_13)',decl:{start:{line:113,column:45},end:{line:113,column:46}},loc:{start:{line:113,column:53},end:{line:126,column:7}},line:113},'14':{name:'(anonymous_14)',decl:{start:{line:116,column:56},end:{line:116,column:57}},loc:{start:{line:116,column:63},end:{line:118,column:11}},line:116},'15':{name:'(anonymous_15)',decl:{start:{line:119,column:24},end:{line:119,column:25}},loc:{start:{line:119,column:31},end:{line:121,column:11}},line:119},'16':{name:'(anonymous_16)',decl:{start:{line:122,column:22},end:{line:122,column:23}},loc:{start:{line:122,column:26},end:{line:124,column:11}},line:122},'17':{name:'(anonymous_17)',decl:{start:{line:127,column:13},end:{line:127,column:14}},loc:{start:{line:127,column:20},end:{line:129,column:7}},line:127},'18':{name:'(anonymous_18)',decl:{start:{line:135,column:2},end:{line:135,column:3}},loc:{start:{line:135,column:33},end:{line:150,column:3}},line:135},'19':{name:'(anonymous_19)',decl:{start:{line:137,column:43},end:{line:137,column:44}},loc:{start:{line:137,column:51},end:{line:145,column:5}},line:137},'20':{name:'(anonymous_20)',decl:{start:{line:141,column:37},end:{line:141,column:38}},loc:{start:{line:141,column:47},end:{line:144,column:9}},line:141},'21':{name:'(anonymous_21)',decl:{start:{line:146,column:11},end:{line:146,column:12}},loc:{start:{line:146,column:18},end:{line:148,column:5}},line:146}},branchMap:{'0':{loc:{start:{line:28,column:16},end:{line:28,column:83}},type:'cond-expr',locations:[{start:{line:28,column:40},end:{line:28,column:64}},{start:{line:28,column:65},end:{line:28,column:83}}],line:28},'1':{loc:{start:{line:29,column:14},end:{line:29,column:78}},type:'cond-expr',locations:[{start:{line:29,column:37},end:{line:29,column:60}},{start:{line:29,column:61},end:{line:29,column:78}}],line:29},'2':{loc:{start:{line:30,column:16},end:{line:30,column:83}},type:'cond-expr',locations:[{start:{line:30,column:40},end:{line:30,column:64}},{start:{line:30,column:65},end:{line:30,column:83}}],line:30},'3':{loc:{start:{line:31,column:18},end:{line:31,column:89}},type:'cond-expr',locations:[{start:{line:31,column:42},end:{line:31,column:68}},{start:{line:31,column:69},end:{line:31,column:89}}],line:31},'4':{loc:{start:{line:32,column:18},end:{line:32,column:89}},type:'cond-expr',locations:[{start:{line:32,column:42},end:{line:32,column:68}},{start:{line:32,column:69},end:{line:32,column:89}}],line:32},'5':{loc:{start:{line:39,column:6},end:{line:41,column:7}},type:'if',locations:[{start:{line:39,column:6},end:{line:41,column:7}},{start:{line:39,column:6},end:{line:41,column:7}}],line:39},'6':{loc:{start:{line:48,column:4},end:{line:53,column:5}},type:'switch',locations:[{start:{line:49,column:6},end:{line:50,column:83}},{start:{line:51,column:6},end:{line:52,column:116}}],line:48},'7':{loc:{start:{line:58,column:70},end:{line:58,column:82}},type:'default-arg',locations:[{start:{line:58,column:77},end:{line:58,column:82}}],line:58},'8':{loc:{start:{line:73,column:6},end:{line:106,column:7}},type:'if',locations:[{start:{line:73,column:6},end:{line:106,column:7}},{start:{line:73,column:6},end:{line:106,column:7}}],line:73},'9':{loc:{start:{line:79,column:8},end:{line:89,column:9}},type:'if',locations:[{start:{line:79,column:8},end:{line:89,column:9}},{start:{line:79,column:8},end:{line:89,column:9}}],line:79},'10':{loc:{start:{line:94,column:10},end:{line:96,column:11}},type:'if',locations:[{start:{line:94,column:10},end:{line:96,column:11}},{start:{line:94,column:10},end:{line:96,column:11}}],line:94}},s:{'0':0,'1':0,'2':0,'3':0,'4':0,'5':0,'6':0,'7':0,'8':0,'9':0,'10':0,'11':0,'12':0,'13':0,'14':0,'15':0,'16':0,'17':0,'18':0,'19':0,'20':0,'21':0,'22':0,'23':0,'24':0,'25':0,'26':0,'27':0,'28':0,'29':0,'30':0,'31':0,'32':0,'33':0,'34':0,'35':0,'36':0,'37':0,'38':0,'39':0,'40':0,'41':0,'42':0,'43':0,'44':0,'45':0,'46':0,'47':0,'48':0,'49':0,'50':0,'51':0,'52':0,'53':0,'54':0,'55':0,'56':0,'57':0,'58':0,'59':0,'60':0,'61':0,'62':0},f:{'0':0,'1':0,'2':0,'3':0,'4':0,'5':0,'6':0,'7':0,'8':0,'9':0,'10':0,'11':0,'12':0,'13':0,'14':0,'15':0,'16':0,'17':0,'18':0,'19':0,'20':0,'21':0},b:{'0':[0,0],'1':[0,0],'2':[0,0],'3':[0,0],'4':[0,0],'5':[0,0],'6':[0,0],'7':[0],'8':[0,0],'9':[0,0],'10':[0,0]},_coverageSchema:'332fd63041d2c1bcb487cc26dd0d5f7d97098a6c'},coverage=global[gcv]||(global[gcv]={});if(coverage[path]&&coverage[path].hash===hash){return coverage[path];}coverageData.hash=hash;return coverage[path]=coverageData;}();const PATH=(++cov_1l1ii2sp80.s[0],require('path'));const fs=(++cov_1l1ii2sp80.s[1],require('fs'));const BASE_64_ENCODER=(++cov_1l1ii2sp80.s[2],require('base64-stream'));const FTP=(++cov_1l1ii2sp80.s[3],require('./_ftpModel'));const CONFIG=(++cov_1l1ii2sp80.s[4],require('./config.json'));class File{constructor(){++cov_1l1ii2sp80.f[0];++cov_1l1ii2sp80.s[5];this._ftp=new FTP();++cov_1l1ii2sp80.s[6];this._config=CONFIG;}_close_connection(){++cov_1l1ii2sp80.f[1];const _self=(++cov_1l1ii2sp80.s[7],this);++cov_1l1ii2sp80.s[8];_self._ftp._close_connection();}_returnActualDate(){++cov_1l1ii2sp80.f[2];++cov_1l1ii2sp80.s[9];return new Date().toISOString().slice(0,19).replace('T',' ');}_appendDateToFilename(){++cov_1l1ii2sp80.f[3];const fecha=(++cov_1l1ii2sp80.s[10],new Date());const month=(++cov_1l1ii2sp80.s[11],fecha.getMonth()+1<10?(++cov_1l1ii2sp80.b[0][0],`0${fecha.getMonth()+1}`):(++cov_1l1ii2sp80.b[0][1],fecha.getMonth()+1));const day=(++cov_1l1ii2sp80.s[12],fecha.getDate()+1<10?(++cov_1l1ii2sp80.b[1][0],`0${fecha.getDate()+1}`):(++cov_1l1ii2sp80.b[1][1],fecha.getDate()+1));const hours=(++cov_1l1ii2sp80.s[13],fecha.getHours()+1<10?(++cov_1l1ii2sp80.b[2][0],`0${fecha.getHours()+1}`):(++cov_1l1ii2sp80.b[2][1],fecha.getHours()+1));const minutes=(++cov_1l1ii2sp80.s[14],fecha.getMinutes()<10?(++cov_1l1ii2sp80.b[3][0],`0${fecha.getMinutes()+1}`):(++cov_1l1ii2sp80.b[3][1],fecha.getMinutes()+1));const seconds=(++cov_1l1ii2sp80.s[15],fecha.getSeconds()<10?(++cov_1l1ii2sp80.b[4][0],`0${fecha.getSeconds()+1}`):(++cov_1l1ii2sp80.b[4][1],fecha.getSeconds()+1));++cov_1l1ii2sp80.s[16];return`${fecha.getFullYear()}_${month}_${day}_${hours}_${minutes}_${seconds}`;}_checkFileExtension(extensions,fileExtension){++cov_1l1ii2sp80.f[4];++cov_1l1ii2sp80.s[17];for(let i=0;i<extensions.length;i++){++cov_1l1ii2sp80.s[18];if(fileExtension.indexOf(extensions[i])>-1){++cov_1l1ii2sp80.b[5][0];++cov_1l1ii2sp80.s[19];return true;}else{++cov_1l1ii2sp80.b[5][1];}}++cov_1l1ii2sp80.s[20];return false;}_fileRoute(contentType,formFields,uploadDirectory,filename){++cov_1l1ii2sp80.f[5];++cov_1l1ii2sp80.s[21];switch(contentType){case"avatar":++cov_1l1ii2sp80.b[6][0];++cov_1l1ii2sp80.s[22];return uploadDirectory+"/"+formFields["id_usuario"]+"/avatar"+filename.ext;case"zip":++cov_1l1ii2sp80.b[6][1];++cov_1l1ii2sp80.s[23];return uploadDirectory+"/"+formFields["carpeta_proveedor"]+"/"+filename.name+"/"+filename.name+filename.ext;}}uploadContentFile(file,formFields,uploadDirectory,extensionsAllowed,avatar=(++cov_1l1ii2sp80.b[7][0],false)){++cov_1l1ii2sp80.f[6];const _self=(++cov_1l1ii2sp80.s[24],this);let newFilename;let ruta_file=(++cov_1l1ii2sp80.s[25],'');let readableStream;function removeVariables(){++cov_1l1ii2sp80.f[7];++cov_1l1ii2sp80.s[26];newFilename=null;++cov_1l1ii2sp80.s[27];ruta_file=null;++cov_1l1ii2sp80.s[28];readableStream=null;}++cov_1l1ii2sp80.s[29];return new Promise((resolve,reject)=>{++cov_1l1ii2sp80.f[8];++cov_1l1ii2sp80.s[30];if(_self._checkFileExtension(extensionsAllowed,PATH.parse(file.originalFilename).ext)){++cov_1l1ii2sp80.b[8][0];++cov_1l1ii2sp80.s[31];newFilename=PATH.parse(file.originalFilename);// If the file is a content, we've to manage it in a different way that if it is an image or something else.
++cov_1l1ii2sp80.s[32];if(!avatar){++cov_1l1ii2sp80.b[9][0];++cov_1l1ii2sp80.s[33];formFields["fecha_alta"]=_self._returnActualDate();++cov_1l1ii2sp80.s[34];formFields["ruta_zip"]=_self._fileRoute("zip",formFields,uploadDirectory,newFilename);++cov_1l1ii2sp80.s[35];ruta_file=formFields['ruta_zip'];// If it's an avatar we have to set the route properly on it
}else{++cov_1l1ii2sp80.b[9][1];++cov_1l1ii2sp80.s[36];formFields['urlAvatar']=_self._fileRoute("avatar",formFields,uploadDirectory,newFilename);++cov_1l1ii2sp80.s[37];ruta_file=formFields['urlAvatar'];}// Create the readableStream to upload the file physically
++cov_1l1ii2sp80.s[38];readableStream=fs.createReadStream(file.path);++cov_1l1ii2sp80.s[39];_self._ftp.uploadFile(readableStream,ruta_file).then(()=>{++cov_1l1ii2sp80.f[9];++cov_1l1ii2sp80.s[40];if(!avatar){++cov_1l1ii2sp80.b[10][0];++cov_1l1ii2sp80.s[41];formFields["ruta_zip"]=_self._fileRoute("zip",formFields,_self._ftp._configuration.ftpConnection.equivalent_url,newFilename);}else{++cov_1l1ii2sp80.b[10][1];}++cov_1l1ii2sp80.s[42];resolve(true);}).catch(err=>{++cov_1l1ii2sp80.f[10];++cov_1l1ii2sp80.s[43];removeVariables();++cov_1l1ii2sp80.s[44];reject(err);});}else{++cov_1l1ii2sp80.b[8][1];++cov_1l1ii2sp80.s[45];removeVariables();++cov_1l1ii2sp80.s[46];reject({error:"No file extension allowed"});}});}downloadImageInBase64(filepath){++cov_1l1ii2sp80.f[11];const _self=(++cov_1l1ii2sp80.s[47],this);++cov_1l1ii2sp80.s[48];return new Promise((resolve,reject)=>{++cov_1l1ii2sp80.f[12];++cov_1l1ii2sp80.s[49];_self._ftp.downloadFile(filepath).then(data=>{++cov_1l1ii2sp80.f[13];let imageData=(++cov_1l1ii2sp80.s[50],`data:image/${PATH.parse(filepath).ext.slice(1)};base64,`);++cov_1l1ii2sp80.s[51];data.pipe(BASE_64_ENCODER.encode()).on("data",buf=>{++cov_1l1ii2sp80.f[14];++cov_1l1ii2sp80.s[52];imageData+=buf;}).once("error",err=>{++cov_1l1ii2sp80.f[15];++cov_1l1ii2sp80.s[53];reject(err);}).once("end",()=>{++cov_1l1ii2sp80.f[16];++cov_1l1ii2sp80.s[54];resolve(imageData);});}).catch(err=>{++cov_1l1ii2sp80.f[17];++cov_1l1ii2sp80.s[55];reject(err);});});}downloadFile(filepath,response){++cov_1l1ii2sp80.f[18];const _self=(++cov_1l1ii2sp80.s[56],this);++cov_1l1ii2sp80.s[57];_self._ftp.downloadFile(filepath).then(data=>{++cov_1l1ii2sp80.f[19];++cov_1l1ii2sp80.s[58];response.attachment(filepath);// We pipe the file throught the readableStream object to the response
++cov_1l1ii2sp80.s[59];data.pipe(response).on("end",function(){++cov_1l1ii2sp80.f[20];++cov_1l1ii2sp80.s[60];_self._ftp._FTPDisconnect();});}).catch(err=>{++cov_1l1ii2sp80.f[21];++cov_1l1ii2sp80.s[61];response.send(err);});}}++cov_1l1ii2sp80.s[62];module.exports=File;